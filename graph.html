<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Graphing page</title>

<!-- ploty.js is used for graph rendering -->
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

<style>
body{
        background: #000;
        color:#0f0;
        font-family: monospace;
        border:10px solid #0f0;
        /* Flexbox makes header - plot - footer stack vertically */
        min-height:100vh;
        flex-direction:column;
        margin:0;
        display:flex;
}

/* consistent spacing for header + footer */
header,footer{
        padding:10px;
        text-align:center;
}

/* Inputs and buttons styled consistently */
input,button{
        margin:5px;
        background:#111;
        padding:6px;
        color:#0f0;
        border:1px solid #0f0;
}

/* Plot container expands to fill leftover space */
#plot{
        flex:1;
}

</style>
</head>
<body>
        <header>
                <h1>Graph of f(x)</h1>

                <!-- User enters raw expression here -->
                <div>
                        <input id = "expr" type="text" value="sin(x)" style="width:200px;">
                </div>
                <div>

                        <!-- Numeric inputs define the sampling domain -->
                        <label >X Range:</label>
                        <input type="number" id ="xMin" value="-10" style="width: 70px;"> →
                        <input type="number" id="xMax" value="10" style="width:70px;">
                        <label>Step:</label>
                        <input id = "step" type="number" value="0.1" step="0.1" style="width:70px;">
                </div>
                <div>
                        <button id="plotBtn">Plot</button>
                        <button id="backBtn">Back to Calculator</button>
                </div>
        </header>


        <!-- Ploty renders the graph into this container -> -->
        <div id="plot"></div>

        <footer>
                Type any function of x, e.g. <code>sin(x)</code>, <code>x^2</code>, <code>ln(x)</code>
        </footer>

 <script>

//     NORMALISATION
//    Convert user-friendly math into valid JS
//    Handles logs, roots, constants, trig, and
//    implicit multiplication like "2x".     
function normalize(expr){
        let e=expr;

        // Logs and roots
        e = e.replace(/ln\(/g,"Math.log(");
        e = e.replace(/log\(/g,"Math.log10(");
        e = e.replace(/sqrt\(/g,"Math.sqrt(");
        e = e.replace(/\^/g,"**");
        e = e.replace(/π/g,"Math.PI");

        // Exponential and trig
        e = e.replace(/\be\b/g,"Math.E");
        e = e.replace(/sin\(/g,"Math.sin(");
        e = e.replace(/cos\(/g,"Math.cos(");
        e = e.replace(/tan\(/g,"Math.tan(");

        // Implicit multiplication
        e = e.replace(/(\d)(x)/g, "$1*$2");
        e = e.replace(/x\(/g, "x*(");
        e = e.replace(/\)(\d|x)/g, ")*$1");

        return e;
}

// PLOT FUNCTION
//    - Reads user input
//    - Normalises expression
//    - Samples y values in range [xMin,xMax]
//    - Renders with Plotly

function plotGraph(){

        // Gather user inputs
        const expr = document.getElementById("expr").value;
        const xMin = parseFloat(document.getElementById("xMin").value);
        const xMax = parseFloat(document.getElementById("xMax").value);
        const step = parseFloat(document.getElementById("step").value);

        // Translate expressions into JS
        const jsExpr = normalize(expr);
        const f = Function("x","return "+jsExpr);

        // sample function values
        const xs = [], ys=[];
        for(let x=xMin; x<=xMax; x+=step){
                xs.push(x);
                try{ys.push(f(x));}catch{ys.push(NaN);}
        }

        // Ploty graph render
        Plotly.newPlot("plot",
                [{x:xs,y:ys,mode:"lines",line:{color:"#0f0"}}],
                {paper_bgcolor:"#000",plot_bgcolor:"#000",
                xaxis:{color:"#0f0"},yaxis:{color:"#0f0"}},
                {displayModeBar:false}

        );
}

document.getElementById("plotBtn").onclick=plotGraph;
document.getElementById("backBtn").onclick=()=>window.location.href="index.html";

plotGraph();

 </script>       
        
</body>
</html>